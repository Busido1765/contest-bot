# Техническое ревью инфраструктуры Contest Bot

> Контекст: это ориентир «на потом». Сейчас приоритет — быстро поднять рабочего бота и адаптировать контент под проект. Рефакторинг и hardening можно делать поэтапно после стабилизации запуска.

## Краткая оценка

Текущий репозиторий выглядит как рабочий инфраструктурный каркас для запуска связки:
- Telegram bot
- background worker (Celery)
- API (FastAPI)
- mini app
- Redis

Это хороший базовый уровень для старта. При этом есть типовые зоны, которые стоит улучшить перед «жёстким» продом: безопасность сети, согласованность env, эксплуатационная надёжность и CI/CD-процесс.

---

## Что уже хорошо

- Разделение на сервисы по ролям (bot/bg/api/front/redis).
- Документация по ручной сборке и запуску контейнеров.
- Есть пример Nginx-конфига для проксирования mini app и API.
- Есть пример env-файла и подсказки по проверке логов.

---

## Зоны улучшения (по приоритету)

### 1) Безопасность и сетевой периметр (высокий приоритет)

- В compose опубликованы наружу `3000`, `8000`, `6379`.
- Для production обычно лучше публиковать только 443 на Nginx, а остальные сервисы держать во внутренней сети Docker.
- Redis даже с паролем лучше не экспонировать в интернет.

**Что делать позже:**
- Добавить production compose-профиль без публикации внутренних портов.
- Ограничить доступ через firewall/security groups.

### 2) Согласованность переменных окружения (высокий приоритет)

- В env-примере Redis URI на `localhost`, тогда как в Docker-сети обычно нужен хост `redis`.
- Важно не забывать `REDIS_PASS`, если Redis запускается с `--requirepass`.

**Что делать позже:**
- Держать единый, проверенный `.env.example` с комментариями.
- Разнести конфигурации по окружениям (`dev/stage/prod`).

### 3) Production-режим контейнеров (средний приоритет)

- Front запускается через `yarn dev` — для production это не лучший режим.
- В Python-образах можно усилить best practices (non-root user, уменьшение слоя, более детерминированная сборка).

**Что делать позже:**
- Для front перейти на production build + production runtime.
- Усилить Dockerfile’ы (безопасность/повторяемость/размер).

### 4) Надёжность фоновых задач (средний приоритет)

- Beat и worker в одном процессе (`celery ... worker -B`) проще, но менее гибко для масштабирования/операций.

**Что делать позже:**
- Разделить worker и beat на отдельные сервисы.

### 5) Эксплуатация и наблюдаемость (средний приоритет)

- Нет healthcheck’ов в compose.
- Нет зафиксированного CI/CD pipeline.
- Минимально описан rollback/релизный процесс.

**Что делать позже:**
- Добавить healthcheck + зависимости запуска.
- Добавить CI (линтеры/тесты/сборка образов).
- Добавить регламент релизов и отката.

---

## Нужен ли рефакторинг сейчас?

**Коротко: частичный и не блокирующий запуск.**

С учётом цели «поднять бота и заменить контент»:
1. Сначала запускаем текущее решение в рабочем виде.
2. Проверяем базовый функционал по чек-листу.
3. После этого идём в плановый инфраструктурный hardening.

---

## Практический план после запуска (этапами)

### Этап A — стабилизация (быстрые победы)
- Актуализировать env-шаблон.
- Зафиксировать рабочую инструкцию запуска для вашей среды.
- Убедиться, что API/front доступны через Nginx, а не напрямую.

### Этап B — безопасность и устойчивость
- Убрать публикацию лишних портов.
- Добавить healthcheck’и.
- Разделить celery worker/beat.

### Этап C — операционная зрелость
- Внедрить CI/CD.
- Перейти на теги образов и registry.
- Добавить базовые метрики/алерты/логирование.

---

## Заметка по приоритетам

Сейчас правильный фокус — **доставка бизнес-ценности** (бот работает, контент адаптирован). Технический долг в этом репозитории управляемый и хорошо раскладывается на понятные итерации.
