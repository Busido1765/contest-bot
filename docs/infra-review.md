# Техническое ревью инфраструктуры Contest Bot (обновлено)

> Контекст: это ориентир «на потом». Сейчас приоритет — поднять рабочего бота и адаптировать контент под проект.

## 0) Что изменилось в оценке после повторной проверки

Критичный факт: в текущем состоянии репозитория **нет основной папки `src/`**, хотя Dockerfile’ы ожидают её наличие (`src/internal`, `src/miniapp`).

Следствие:
- текущий репозиторий — это инфраструктурный каркас + документация;
- запуск сервисов возможен только после возврата/добавления приложения (исходников).

Это главный пробел №1 и причина, почему деплой может не стартовать даже при корректном `.env`.

---

## 1) Моя текущая точка зрения по реализации

В целом архитектурная идея адекватная для MVP:
- bot + bg + api + front + redis — логично разделены по зонам ответственности;
- есть базовая инструкция развертывания;
- есть Nginx-шаблон и env-шаблон.

Но технически это пока «заготовка под прод», а не fully production-ready контур.

### Что можно улучшить

1. **Комплектность репозитория** (критично)
   - Гарантировать наличие основной кодовой части (`src`) в этой же репе или явно задокументировать multi-repo процесс сборки.

2. **Конфигурационная целостность**
   - Привести `.env.example` в соответствие compose-конфигу (`REDIS_PASS`, host `redis`).

3. **Безопасность сети**
   - Убрать публикацию внутренних портов (`3000/8000/6379`) в production-профиле.

4. **Надёжность и эксплуатация**
   - Добавить healthcheck’и, readiness-зависимости, разделить Celery worker/beat.

5. **Стандартизация поставки**
   - Добавить CI/CD, версионирование образов, registry-процесс.

### Где пробелы

- Нет исходников приложения в текущем tree.
- Нет healthcheck’ов и фиксированного релизного процесса.
- Есть рассинхрон документации и примеров env.
- Front в `dev`-режиме (подходит для разработки, но не оптимально для production).

### Нужен ли рефакторинг?

**Да, но поэтапный:**
- сначала восстановить/подключить основной код и запустить рабочий контур;
- затем сделать инфраструктурный hardening;
- потом довести до production-уровня по CI/CD и наблюдаемости.

---

## 2) Что не хватает с технической точки зрения

Минимальный чек-лист «до зрелого прод-состояния»:

- [ ] Полная кодовая база (или документированный multi-repo workflow).
- [ ] Актуальный `.env.example` с обязательными переменными.
- [ ] Разделение `docker-compose.dev.yml` и `docker-compose.prod.yml`.
- [ ] Healthcheck + restart/readiness стратегия.
- [ ] Разделение Celery worker и beat.
- [ ] Production-режим front (build + runtime).
- [ ] CI pipeline (lint/test/build).
- [ ] Артефакты/образы в registry с тегами.
- [ ] Базовое мониторирование и алертинг.

---

## 3) Рекомендованный порядок действий (практично)

### Этап A — «запуститься сейчас»
1. Вернуть `src/` в репозиторий или подключить репо с кодом.
2. Проверить, что Dockerfile’ы видят нужные пути.
3. Пройти quickstart и удостовериться, что bot/api/bg/front поднимаются.

### Этап B — «стабильно работать»
1. Привести env и compose к единому стандарту.
2. Внедрить healthcheck’и.
3. Стабилизировать проксирование через Nginx.

### Этап C — «системно масштабироваться»
1. Разделить роли background-сервисов.
2. Добавить CI/CD и image lifecycle.
3. Добавить наблюдаемость и управляемые релизы.

---

## 4) Итог

С инженерной точки зрения идея проекта правильная, но в текущем слепке репозитория не хватает главного слоя — кода приложения.

Поэтому сейчас оптимальная стратегия:
- сначала восстановить комплектность и поднять рабочую версию под ваш контент;
- затем планомерно закрыть инфраструктурные пробелы.
